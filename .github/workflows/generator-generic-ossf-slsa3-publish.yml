# This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
# documentation.

# This workflow lets you generate SLSA provenance file for your project.
# The generation satisfies level 3 for the provenance requirements - see https://slsa.dev/spec/v0.1/requirements
# The project is an initiative of the OpenSSF (openssf.org) and is developed at
# https://github.com/slsa-framework/slsa-github-generator.
# The provenance file can be verified using https://github.com/slsa-framework/slsa-verifier.
# For more information about SLSA and how it improves the supply-chain, visit slsa.dev.

name: SLSA generic generator
on:
  workflow_dispatch:
  release:
    types: [created]

jobs:
  build:
    runs-on: ubuntu-latest
    outputs:
      digests: ${{ steps.hash.outputs.digests }}

    steps:
      - uses: actions/checkout@v4

      # ========================================================
      #
      # Step 1: Build your artifacts.
      #
      # ========================================================
      - name: Build artifacts
        run: |
            # These are some amazing artifacts.
            echo "artifact1" > artifact1
            echo "artifact2" > artifact2

      # ========================================================
      #
      # Step 2: Add a step to generate the provenance subjects
      #         as shown below. Update the sha256 sum arguments
      #         to include all binaries that you generate
      #         provenance for.
      #
      # ========================================================
      - name: Generate subject for provenance
        id: hash
        run: |
          set -euo pipefail

          # List the artifacts the provenance will refer to.
          files=$(ls artifact*)
          # Generate the subjects (base64 encoded).
          echo "hashes=$(sha256sum $files | base64 -w0)" >> "${GITHUB_OUTPUT}"

  provenance:
    needs: [build]
    permissions:
      actions: read   # To read the workflow path.
      id-token: write # To sign the provenance.
      contents: write # To add assets to a release.
    uses: slsa-framework/slsa-github-generator/.github/workflows/generator_generic_slsa3.yml@v1.4.0
    with:
      base64-subjects: "${{ needs.build.outputs.digests }}"
      upload-assets: true # Optional: Upload to a new release
            - الاسم: تحميل ملف بناء
  يستخدم: actions/upload-artifact@v6.0.0
  مع:
    - اسم القطعة الأثرية
    الاسم: # اختياري، القيمة الافتراضية هي قطعة أثرية
    # ملف أو مجلد أو نمط عام يصف ما سيتم تحميله
    طريق:
    # السلوك المطلوب في حالة عدم العثور على أي ملفات باستخدام المسار المقدم.
الخيارات المتاحة:
  تحذير: قم بإخراج تحذير ولكن لا تفشل العملية
  خطأ: فشل الإجراء مع ظهور رسالة خطأ
  تجاهل: لا تُصدر أي تحذيرات أو أخطاء، فالإجراء لا يفشل.

    if-no-files-found: # اختياري، القيمة الافتراضية هي warn
    # المدة التي تنتهي بعدها صلاحية الملف بالأيام. 0 تعني استخدام مدة الاحتفاظ الافتراضية.
الحد الأدنى يوم واحد. الحد الأقصى 90 يومًا ما لم يتم تغيير ذلك من صفحة إعدادات المستودع.

    أيام الاحتفاظ: # اختياري
    # مستوى الضغط الذي سيطبقه Zlib على أرشيف الملفات. تتراوح القيمة من 0 إلى 9: - 0: بدون ضغط - 1: أفضل سرعة - 6: الضغط الافتراضي (مماثل لـ GNU Gzip) - 9: أفضل ضغط. تؤدي المستويات الأعلى إلى ضغط أفضل، ولكنها تستغرق وقتًا أطول. بالنسبة للملفات الكبيرة التي يصعب ضغطها، يُنصح باستخدام القيمة 0 لتحميل أسرع بكثير.

    مستوى الضغط: # اختياري، القيمة الافتراضية هي 6
    # إذا كانت القيمة صحيحة، فسيتم حذف العنصر الذي يحمل نفس الاسم قبل تحميل عنصر جديد. أما إذا كانت القيمة خاطئة، فسيفشل الإجراء إذا كان هناك عنصر موجود بالفعل بنفس الاسم. ولن يفشل الإجراء إذا لم يكن العنصر موجودًا.

    الكتابة فوق: # اختياري، القيمة الافتراضية هي خطأ
    # إذا كانت القيمة صحيحة، فسيتم تضمين الملفات المخفية في الملف الناتج. إذا كانت القيمة خاطئة، فسيتم استبعاد الملفات المخفية من الملف الناتج.

    تضمين الملفات المخفية: # اختياري، القيمة الافتراضية هي خطأ
          
